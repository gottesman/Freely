.now-playing { display:flex; flex-direction:column; gap:24px; padding-top: var(--np-hero-height, 320px); }
.np-hero {
    /* adjustable via JS: --np-hero-height will be set between min/max */
    --np-hero-max-height: 320px;
    --np-hero-min-height: 64px;
    --np-hero-padding-top: 32px;
    --np-hero-padding-bottom: 28px;
    --np-title-size: 56px;

    position:fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--np-hero-height);
    display:flex;
    align-items:flex-end;
    overflow:hidden;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    isolation:isolate;
    z-index:200; /* keep above page content when fixed */
    -webkit-backdrop-filter: blur(6px);
    backdrop-filter: blur(6px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);

    /* transition: height 160ms linear, box-shadow 160ms linear, backdrop-filter 160ms linear; */
}
.np-hero::before { content:""; position:absolute; inset:0; z-index:-1; mask:linear-gradient(to bottom,#fff 20%, #fff3 70%, #fff0); -webkit-mask:linear-gradient(to bottom,#fff 20%, #fff3 70%, #fff0); background: linear-gradient(140deg, rgba(0,0,0,.6), rgba(0,0,0,.2)), var(--hero-image) center / cover no-repeat; box-shadow: inset 0 0 400px var(--color-bg-solid);}
.np-hero-inner { position:relative; z-index:1; display:flex; flex-direction:column; align-items:flex-start; gap:12px; padding:var(--np-hero-padding-top) 32px var(--np-hero-padding-bottom); width:100%; transition: padding 160ms linear; }

/* Switch header inner layout to row when shrunk beyond threshold */
.np-hero[data-np-shrink-state="large"] .np-hero-inner {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
}

.np-hero[data-np-shrink-state="large"] .np-extras {
    width: auto; /* don't stretch across the header when shrunk */
}

/* Extras layout and shrink behavior */
.np-hero .np-extras {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    width: 100%;
}

.np-hero .np-tags {
    transition: opacity 160ms linear, max-height 160ms linear, margin 160ms linear;
    max-height: 40px;
    overflow: hidden;
}

.np-hero .np-meta-line {
    transition: opacity 160ms linear, transform 160ms ease, margin 160ms ease;
}

/* Small helper: when using inline styles to set --np-shrink, meta and tags will animate smoothly */
.np-hero .np-actions { display:flex; gap:4px; align-items:center; }
.np-title { font-size:var(--np-title-size); font-weight:500; margin:0; line-height:1.05; letter-spacing:-.5px; max-width:100%; text-wrap:balance;}
.np-art-wrapper { position:relative; width:240px; max-width:60%; aspect-ratio:1/1; border-radius:18px; overflow:hidden; box-shadow: var(--shadow-lg), 0 2px 6px rgba(0 0 0 / .4); }
.np-meta-line { display:flex; align-items:center; gap:10px; font-size:14px; opacity:.85; }
.np-dot { width:4px; height:4px; border-radius:50%; background:rgba(255,255,255,0.4); }
.np-link { background:none; border:none; color:var(--accent); font:inherit; cursor:pointer; padding:0; pointer-events: auto; }
.np-link:hover { text-decoration:underline; }
.np-extras { display:grid; grid-template-columns:1fr auto; width:100%; gap:8px; align-items:center; }
.np-tags { display:flex; gap:6px; flex-wrap:wrap; }
.np-actions { display:flex; gap:4px; }
.np-icon { background:var(--glass-bg); border:1px solid var(--glass-border); color:var(--text); width:34px; height:34px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer; padding:0; transition: background var(--dur-med), border-color var(--dur-med), transform var(--dur-med); }
.np-icon:hover { background:var(--glass-bg-hover); border-color:var(--glass-border-hover); }
.np-icon:active { transform:scale(.92); }
.np-section { display:flex; flex-direction:column; gap:14px; padding:18px; }
.np-sec-title { font-size:18px; margin:0; letter-spacing:.5px; }
.np-album-heading { display:flex; align-items:flex-end; gap:10px; flex-wrap:wrap; margin-top:-6px; }
.np-album-name { font-size:26px; font-weight:600; background:linear-gradient(90deg, var(--accent), var(--accent-soft,#7fd)); -webkit-background-clip:text; background-clip:text; color:transparent; line-height:1.15; }
.np-album-trackcount { font-size:13px; opacity:.65; font-weight:400; letter-spacing:.5px; line-height:1.4; }

/* Queue */
.np-queue-list { list-style:none; margin:0; padding:0 8px; display:flex; flex-direction:column; gap:6px; }
.np-queue-list li { display:flex; gap:10px; align-items:center; background:var(--surface-1); padding:8px 10px; border-radius:10px; font-size:13px; line-height:1.2; border:1px solid var(--border-subtle); cursor:pointer; transition: background var(--dur-med), border-color var(--dur-med), transform 160ms cubic-bezier(.2,.8,.3,1); position:relative; will-change:transform; }
.np-queue-list.no-tx li { transition: background var(--dur-med), border-color var(--dur-med); }
.np-queue-list li:hover { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.12); }
.queue-more-btn{opacity: 0;}
.np-queue-list li:hover .queue-more-btn { opacity:1; }
.np-queue-list li.active { background:var(--accent); color:#021; border:transparent; font-weight:inherit; box-shadow:0 0 0 1px rgba(0,0,0,0.15) inset; }
.np-queue-list li .track { flex:1 1 auto; }
.np-queue-list li .artist { opacity:.7; }
.np-queue-list li .queue-art { width:38px; height:38px; border-radius:8px; overflow:hidden; background:rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:center; flex-shrink:0; box-shadow:0 2px 4px -1px rgba(0,0,0,.4); }
.np-queue-list li .queue-art img { width:100%; height:100%; object-fit:cover; display:block; }

/* Hover play button overlay */
.queue-play-btn { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.55); color:#fff; border:none; cursor:pointer; opacity:0; transition: opacity var(--dur-med); font-size:18px; margin:0; padding:0; }
.queue-play-btn .material-symbols-rounded { --size:22px; }
.np-queue-list li:not(.active):hover .queue-play-btn { opacity:1; }

/* Suppress play overlay while hovering drag handle (browsers supporting :has) */
.np-queue-list li:has(.queue-drag-handle:hover) .queue-play-btn { opacity:0 !important; }

/* Active dragging item visual */
.np-queue-list li.dragging-item { box-shadow:0 0 0 2px var(--accent) inset, 0 4px 12px -2px rgba(0,0,0,.6); z-index:3; backdrop-filter: blur(15px); }

.collapsed .np-queue-list { padding:0; }
.collapsed .np-queue-list li { justify-content:center; padding: 8px; }
.collapsed .np-queue-list li >:not(.queue-art) { display:none !important; }

/* Tracklist */
.np-tracklist { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:4px; }
.np-tracklist li { position:relative; display:grid; grid-template-columns:14px 1fr var(--artist-col-width,170px) 30px; align-items:center; gap:10px; font-size:13px; padding:6px 10px; border-radius:8px; cursor:pointer; background:var(--surface-1); border:1px solid var(--border-subtle); transition: background var(--dur-med), border-color var(--dur-med), transform var(--dur-med); }

/* Inline play button overlaying index */
.track-action { position:absolute; left:2px; top:50%; transform:translateY(-50%) scale(.7); background:#fff0; border:none; color:var(--text); width:28px; height:28px; border-radius:8px; display:flex; align-items:center; justify-content:center; padding:0; cursor:pointer; opacity:0; transition: opacity var(--dur-med), transform var(--dur-med), background var(--dur-med), border-color var(--dur-med); }
.queue-track-btn {
    left: -21px;
}
.np-tracklist li:hover .track-action, .np-tracklist li:not(.playing):hover .track-action { opacity:1; transform:translateY(-50%) scale(1); }
.np-tracklist li:hover .index:not(.playing-icon), .np-tracklist li:not(.playing):hover .tl-actions .duration { opacity:0; }
.track-action:hover { color:var(--accent) }
.selected .track-action{ color:#021; }
.selected .track-action:hover{ color:#fff; }
.np-tracklist li:hover .track-action:active { transform:translateY(-50%) scale(.8); }

/* Delete button in tl-actions */
.delete-track-btn { background:#fff0; border:none; color:var(--text); width:24px; height:24px; border-radius:6px; display:flex; align-items:center; justify-content:center; padding:0; cursor:pointer; opacity:0; transition: opacity var(--dur-med), transform var(--dur-med), color var(--dur-med); }
.np-tracklist li:hover .delete-track-btn { opacity:1; }
.delete-track-btn:hover { color:#ff4444; transform:scale(1.1); }
.selected .delete-track-btn { color:#021; opacity:0.7; }
.selected .delete-track-btn:hover { color:#ff6666; opacity:1; }
.delete-track-btn:active { transform:scale(.9); }
.np-tracklist li:hover { background:rgba(255,255,255,0.06); border-color:rgba(255,255,255,0.12); }



.np-tracklist li.selected { background:var(--accent); color:#021 !important; border-color:transparent; font-weight:600; }
.np-tracklist li.playing:not(.selected) { background:var(--surface-active); border-color:rgba(255,255,255,0.12); }
.np-tracklist li .t-title { font-weight:500; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.np-tracklist li .t-artist-col { font-size:12px; font-weight:400; opacity:.55; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; letter-spacing:.2px; text-align: center; }
.np-tracklist li.selected .t-artist-col { opacity:.85; }
.np-tracklist li .index { text-align:center; font-variant-numeric:tabular-nums; opacity:.7; display:flex; align-items:center; justify-content:center; }
.np-tracklist li.selected .index { opacity:1; }
.np-tracklist li .tl-actions { position:relative; display:flex; align-items:center; justify-content:flex-end; min-width:0; }
.np-tracklist li .duration { font-variant-numeric:tabular-nums; opacity:.55; font-size:12px; margin-right:4px; transition: opacity var(--dur-med); }
.np-tracklist li.selected .duration { opacity:.9; }
.np-tracklist li .playing-icon .material-symbols-rounded { --size:20px; color:#fff; }
.np-tracklist li.selected .playing-icon .material-symbols-rounded { color:#021; }
@media (max-width:900px){ .np-tracklist li { grid-template-columns:28px 1fr 60px; } .np-tracklist li .t-artist-col { display:none; } .np-title { font-size:32px; } .np-hero-inner { padding:28px 24px 24px; } }
@media (max-width:600px){ .np-title { font-size:26px; } .np-hero { min-height:240px; } .np-hero-inner { padding:24px 20px 20px; } }

/* Lyrics Overlay */
.np-lyrics-overlay {
    align-items: center;
    position:absolute;
    inset:0;
    z-index:903;
    pointer-events:none;
    opacity:0;
    display:flex;
    justify-content:center;
    background: radial-gradient(circle at 50% 50%, rgba(var(--bg),0.6), rgba(0,0,0,0.8));
    backdrop-filter: blur(60px) saturate(120%);
    transition: opacity .35s;
    border-radius:inherit;
    box-shadow:0 0 0 1px rgba(255,255,255,0.04) inset;
}
.np-lyrics-overlay.active { pointer-events:auto; opacity:1; }
.lyrics-section {
    display: flex;
    flex-direction: column;
    gap: var(--padding-xs);
}
.lyrics-section span {
    --this-border: transparent;
    --this-background: transparent;
    font-family: Poppins, var(--font-ui), system-ui, sans-serif;
	font-weight:500;
	letter-spacing:1px;
	text-wrap: auto;
    padding: var(--padding-xs) var(--padding-md);
    border-radius: var(--radius-lg);
    width: fit-content;
    border: solid 1px var(--this-border);
    background: var(--this-background);
    position: relative;
    z-index: 0;
    scale: 1;
    opacity: 0.85;
    transition: background-color 160ms ease, border-color 160ms ease, scale 160ms ease, opacity 160ms ease;
}
.lyrics-section span.active {
    --this-border: var(--glass-bg-hover);
    --this-background: var(--glass-bg);
    padding: var(--padding-xs) var(--padding-md);
    border-radius: var(--radius-lg);
    width: fit-content;
    z-index: 1;
    scale: 1.1;
    opacity: 1;
}
.np-lyrics-scroll { max-width:860px; width:100%; max-height:80vh; overflow:auto; position:relative; }
.np-lyrics-body { white-space:pre-wrap; font-family:inherit; font-size:16px; line-height:1.6; padding:60px 40px; }
.np-overlay-close { position:absolute; top:8px; right:8px; }

/* Artist Info */
.np-artist-info { --special-color: color-mix(in srgb, var(--secondary) 30%, #22222240); gap:26px; background-color: var(--special-color); }
.artist-header { display:flex; align-items:center; gap:22px; }
.artist-avatar-wrap { width:120px; height:120px; border-radius:32px; overflow:hidden; box-shadow:0 6px 18px -4px rgba(0,0,0,0.55); flex-shrink:0; }
.artist-avatar-wrap img { width:100%; height:100%; object-fit:cover; display:block; }
.artist-primary { display:flex; flex-direction:column; gap:10px; }
.artist-name { font-size:28px; margin:0; letter-spacing:.5px; }
.artist-stats { display:flex; flex-wrap:wrap; gap:14px; font-size:12px; opacity:.85; align-items:center; }
.artist-stats strong { font-weight:600; letter-spacing:.5px; }
.bio-content { position:relative; font-size:13px; line-height:1.55; }
.collapsed .bio-content {
	max-height:90px;
	overflow:hidden;
	-webkit-mask:linear-gradient(to bottom,#fff 0%, rgb(0 0 0 / 0) 80%);
	mask:linear-gradient(to bottom,#fff 0%, rgba(0,0,0,0) 80%);
}
.bio-toggle { align-self:center; color:var(--accent); font-size:11px; font-weight:500; line-height:1; padding:6px 14px 7px; cursor:pointer; letter-spacing:.4px; top:-10px; }
.bio-toggle:active { transform:translateY(1px); }
.artist-top-tracks { display:flex; flex-direction:column; gap:10px; }
.mini-title { font-size:14px; margin:0 0 2px; opacity:.85; letter-spacing:.5px; text-transform:uppercase; }
.mini-tracklist { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:4px; }
.mini-tracklist li { display:grid; grid-template-columns:22px 1fr 60px; align-items:center; gap:10px; font-size:12px; padding:6px 10px; border-radius:6px; background:var(--surface-1); border:1px solid var(--border-subtle); }
.mini-tracklist li .index { text-align:right; opacity:.6; font-variant-numeric:tabular-nums; }
.mini-tracklist li .plays { text-align:right; opacity:.45; font-variant-numeric:tabular-nums; }
.related-chips { display:flex; flex-wrap:wrap; gap:6px; }
.artist-links-cta { display:flex; gap:10px; }
.follow-btn { background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.14); }
.follow-btn:hover { background:rgba(255,255,255,0.16); border-color:rgba(255,255,255,0.26); }
.np-lyrics-preview { font-size:13px; line-height:1.5; }
.np-lyrics-snippet { margin:0; opacity:.75; }

/* Track Credits */
.np-track-credits { background: var(--surface-alt); }
.credits-list { list-style:none; margin:0; padding:4px 4px 2px; display:grid; gap:6px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
.credits-list li { background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); padding:8px 12px 9px; border-radius:10px; font-size:12px; line-height:1.3; letter-spacing:.3px; display:flex; gap:4px; flex-wrap:wrap; align-items:baseline; }
.credits-list li:hover { background:rgba(255,255,255,0.07); border-color:rgba(255,255,255,0.12); }
.credits-list .cl-label { font-weight:600; opacity:.85; text-transform:uppercase; font-size:11px; letter-spacing:.6px; }
.credits-list .cl-value { font-weight:500; opacity:.82; }
.credits-list li.loading .cl-value { opacity:.55; font-style:italic; }

/* Audio source chooser (SongInfoTab) */
.np-audio-sources { 
    height: calc(100vh - var(--header-height) - var(--footer-height) - var(--footer-gap) - var(--app-shadow-size) * 2) - var(--np-hero-height);
    background: var(--surface-alt2);
    padding: var(--padding-lg); 
}
.np-audio-sources .np-sec-title { margin-bottom:6px; }
.sources-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
.source-item {
    --source-highlight: var(--accent);
    display: flex;    
    gap: 12px;
    background: var(--surface-1);
    padding: 10px;
    border-radius: 10px;
    font-size: 13px;
    line-height: 1.25;
    border: 1px solid var(--border-subtle);
    flex-direction: column;
    align-items: stretch;
    cursor: pointer;
    box-shadow: inset 0 0 0 transparent;
    transition: box-shadow var(--dur-med), border-color var(--dur-med), background var(--dur-med), transform var(--dur-med);
}
.source-item:not(.loading):hover { background:var(--glass-bg-hover); border-color:var(--accent); transform:translateY(-2px); }
.source-item.error { --source-highlight: color-mix(in srgb, var(--warning) 50%, transparent); }
.source-item.loading { --source-highlight: var(--surface-hover); }

.source-item.selected, .source-item.error, .source-item.loading {
    box-shadow: inset 0 0 80px var(--source-highlight);
    border-color: var(--source-highlight);
    cursor:default;
}
.source-element {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.source-output {
    display: none;
    background: rgba(var(--bg), 0.5);
    padding: var(--padding-md);
    border-radius: var(--radius-md);
}
.source-output.show {
    display: block;
}
.track-file.current {
    background: var(--accent);
    color: #021;
    font-weight: bold;
    border-radius: 4px;
    padding: 2px 6px;
}
.source-meta { display:flex; flex-direction:column; gap:4px; min-width:0; }
.source-meta strong { font-weight:600; display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.source-sub { font-size:12px; opacity:.65; }
.source-actions { display:flex; gap:8px; align-items:center; }
.source-actions .btn { padding:6px 10px; font-size:13px; }
.sources-container {
    height: 100%;
    overflow: auto;
    background: rgba(var(--bg),0.8);
    border-radius: var(--radius-lg);
    padding: var(--radius-lg);
}
.np-hint {
    font-size: 14px;
    font-weight: 400;
    display: inline;
    padding: 0 var(--padding-lg);
    opacity: 0.5;
}

@media (max-width:600px){
	.source-item { flex-direction:column; align-items:flex-start; }
	.source-actions { width:100%; justify-content:flex-start; margin-top:8px; }
}

/* Animated loading dots used in TrackSources */
.loading-dots { 
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: 3px;
	font-weight: bold;
	letter-spacing: 1px;
	line-height: 1;
}
.loading-dots span {
	display: inline-block;
	width: 5px;
	height: 5px;
	border-radius: 50%;
	background: currentColor;
	opacity: .3;
		animation: loading-dot-pulse 1s infinite ease-in-out;
}
.loading-dots span:nth-child(2) { animation-delay: .2s; }
.loading-dots span:nth-child(3) { animation-delay: .4s; }

@keyframes loading-dot-pulse {
	0%, 70%, 100% { transform: scale(.5); opacity: .25; }
	35% { transform: scale(1); opacity: 1; }
}
.track-progress .bar.disabled {
    overflow: hidden;
}
.track-progress .bar::before{
    --stripe-width: 20px; /* 10px color + 10px transparent */
    --diagonal-repeat: calc(var(--stripe-width) * 1.4142); /* stripe-width * sqrt(2) for -45deg */
    
    content: "";
    background: repeating-linear-gradient(-45deg, #fff, #fff 10px, #ffffff00 10px, #ffffff00 20px);
    width: 200%;
    left: -100%;
    height: 100%;
    display: block;
    position: relative;
    z-index: 1;
    animation: progress-bar-disabled 2s linear infinite;
    animation-play-state: paused;
    border-radius: inherit;
    opacity: 0;
    transition: opacity 160ms linear;
    will-change: transform; /* Hint for GPU acceleration */
}
.track-progress .bar.disabled::before {
    animation-play-state: running;
    opacity:1;
}

@keyframes progress-bar-disabled {
    0% { transform: translateX(0); }
    100% { transform: translateX(var(--diagonal-repeat)); }
}